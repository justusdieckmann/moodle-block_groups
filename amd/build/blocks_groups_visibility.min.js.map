{"version":3,"sources":["../src/blocks_groups_visibility.js"],"names":["define","$","ajax","url","notification","str","removeWarning","identifier","find","remove","removeSpinner","groupid","divgroup","show","removeSpinners","divgroups","reloadPage","location","reload","createWarningMessage","get_strings","component","done","s","confirm","fail","exception","addSpinner","length","imgurl","imageUrl","spinner","document","createElement","className","src","hidden","before","hide","addWarning","warningexist","warning","on","changevisibility","event","data","promises","call","methodname","args","groups","id","courseid","ajaxError","then","response","error","replaceWith","newelement","visibility","removeClass","addClass","checkMember","membergroup","addSpinners","addNotification","type","text","message","changeVisibilityAll","action","key","initialise"],"mappings":"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","sourcesContent":["// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * Javascript module for block_groups\n *\n * @package    block_groups\n * @copyright  2016/17 N Herrmann\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/url', 'core/notification', 'core/str'], function($, ajax, url, notification, str) {\n    /**\n     * Methode to remove warnings\n     * @param {(Number|String)} identifier\n     */\n    var removeWarning = function(identifier) {\n        $('.block_groups').find('.warning' + identifier).remove();\n    };\n    /**\n     * Removes the Spinner Class of a single group.\n     * @param {Number} groupid that identifies to which group the spinner belongs to.\n     */\n    var removeSpinner = function(groupid) {\n        var divgroup = $('.block_groups');\n        divgroup.find('.spinner' + groupid).remove();\n        divgroup.find('.imggroup-' + groupid).show();\n    };\n    /**\n     * Removes all spinners.\n     */\n    var removeSpinners = function() {\n        var divgroups = $('.block_groups');\n        divgroups.find('.spinner-all').remove();\n        divgroups.find('.imggroup').show();\n    };\n    /**\n     * Reloads the current page.\n     */\n    var reloadPage = function() {\n        location.reload(true);\n    };\n    /**\n     * Creates a warning message.\n     */\n    var createWarningMessage = function() {\n\n        str.get_strings([\n            {'key': 'errortitle', component: 'block_groups'},\n            {'key': 'nochangeindatabasepossiblereload', component: 'block_groups'},\n            {'key': 'yes'},\n            {'key': 'no'}\n        ]).done(function(s) {\n            notification.confirm(s[0], s[1], s[2], s[3], reloadPage);\n        }).fail(notification.exception);\n    };\n    /**\n     * Initialises Spinner for a single group.\n     * @param {Number} groupid\n     */\n    var addSpinner = function(groupid) {\n        var divgroups = $('.block_groups');\n        if (divgroups.find('.warning' + groupid).length > 0) {\n\n            removeWarning(groupid);\n        }\n        var imgurl = url.imageUrl(\"i/loading_small\", 'moodle');\n        var spinner = document.createElement(\"img\");\n        spinner.className = 'spinner' + groupid + ' spinner block-groups-spinner';\n        spinner.src = imgurl;\n        spinner.hidden = false;\n\n        divgroups.find('.imggroup-' + groupid).before(spinner);\n        divgroups.find('.imggroup-' + groupid).hide();\n    };\n    /**\n     * Adds a warning(triangle with exclamation mark) in case the response is empty or the response throws an error.\n     * @param {(Number|String)} identifier\n     * @returns {Boolean} false\n     */\n    var addWarning = function(identifier) {\n        var divgroups = $('.block_groups');\n        var warningexist = divgroups.find('.warning' + identifier);\n        if (warningexist.length) {\n            removeSpinner(identifier);\n            return false;\n        } else {\n            if (identifier === 'all') {\n                removeSpinners();\n            } else {\n                removeSpinner(identifier);\n            }\n            var imgurl = url.imageUrl(\"i/warning\", 'moodle');\n            var warning = document.createElement(\"img\");\n            warning.className = 'warning' + identifier + ' block-groups-warning';\n            warning.src = imgurl;\n            createWarningMessage();\n            (divgroups.find('.imggroup-' + identifier).before(warning));\n            divgroups.find('.imggroup-' + identifier).on('click', createWarningMessage);\n            divgroups.find('.warning' + identifier).on('click', createWarningMessage);\n        }\n        return false;\n    };\n    /**\n     * Method that calls for an ajax script and replaces and/or changes the output components for a single group.\n     * @param {*} event\n     * @return {Boolean}\n     */\n    var changevisibility = function(event) {\n        var divgroups = $('.block_groups');\n\n        var groupid = $(this).data('groupid');\n        if (divgroups.find('.spinner' + $(this).data('groupid')).length > 0 ||\n            divgroups.find('.spinner-all').length > 0) {\n            return false;\n        }\n        addSpinner($(this).data('groupid'));\n        var promises = ajax.call([\n\n            {\n                methodname: 'block_groups_create_output', args: {\n                    groups: {\n                        id: $(this).data('groupid'),\n                        courseid: event.data.courseid\n                    }\n\n                }\n            }\n        ]);\n        $(document).ajaxError(function() {\n            addWarning(groupid);\n            return false;\n        });\n\n        promises[0].then(function(response) {\n            if (response === null || response.error === true) {\n                addWarning(groupid);\n                return false;\n            }\n            divgroups.find('.group-' + response.id).replaceWith(response.newelement);\n            // Replaces the used element, therefore removes the spinner.\n            if (response.visibility === 0) {\n                divgroups.find('.membergroup-' + response.id).removeClass('hiddengroups');\n            }\n            if (response.visibility === 1) {\n                divgroups.find('.membergroup-' + response.id).addClass('hiddengroups');\n            }\n            divgroups.find('.group-' + response.id + ' .block_groups_toggle').on('click',\n                {courseid: event.data.courseid}, changevisibility);\n            removeSpinner(response.id);\n            return false;\n        }).fail(function() {\n            addWarning(groupid);\n            return false;\n        });\n        return false;\n    };\n    var checkMember = function(response) {\n        var membergroup = $('.block-groups-membergroup');\n        var visibility = response.visibility;\n        if (visibility === 2) {\n            membergroup.removeClass('hiddengroups');\n        }\n        if (visibility === 1) {\n            membergroup.addClass('hiddengroups');\n        }\n    };\n    /**\n     * Initialises spinners for all groups.\n     */\n    var addSpinners = function() {\n        var divgroups = $('.block_groups');\n        if (divgroups.find('.warningall').length > 0) {\n            removeWarning('all');\n        }\n        var imgurl = url.imageUrl(\"i/loading_small\", 'moodle');\n        var spinner = document.createElement(\"img\");\n        spinner.className = 'spinner-all spinner block-groups-spinner';\n        spinner.src = imgurl;\n        spinner.hidden = false;\n        divgroups.find('.imggroup').before(spinner);\n        divgroups.find('.imggroup').hide();\n    };\n\n    var addNotification = function(type, text) {\n        notification.addNotification({\n            message: text,\n            type: type\n        });\n    };\n    /**\n     * Method that calls for an ajax script and replaces and/or changes the output components for all groups.\n     * @param {Number} event\n     * @return {Boolean}\n     */\n    var changeVisibilityAll = function(event) {\n        if ($('.block_groups').find('.spinner').length > 0) {\n            return false;\n        }\n        var warningexist = $('.block_groups').find('.block-groups-warning');\n        if (typeof warningexist !== 'undefined' && warningexist.length > 0) {\n            addWarning('all');\n            return false;\n        }\n        addSpinners();\n        // Calls for the externallib.\n        var promises = ajax.call([\n            {\n                methodname: 'block_groups_create_allgroups_output', args: {\n                    groups: {\n                        action: $(this).data('action'),\n                        courseid: event.data.courseid\n                    }\n                }\n            }\n        ]);\n        $(document).ajaxError(function() {\n            addWarning('all');\n            return false;\n        });\n        // Response is processed.\n        promises[0].then(function(response) {\n            var divgroups = $('.block_groups');\n            // Catch misleading responses.\n            if (response === null || response.error === true) {\n                addWarning('all');\n                return false;\n            }\n            if (response.visibility === 0) {\n                // Is nearly impossible since group has to be deleted during the request, however it is\n                // possible, therefore a special message is thrown.\n                divgroups.find('.content').replaceWith(response.newelement);\n                str.get_strings([\n                    {key: 'nogroups', component: 'block_groups'}\n                ]).done(function(s) {\n                    addNotification('error', s[0]);\n                }).fail(notification.exception);\n                return false;\n            }\n\n            // Old Elements are replaced and on click event added.\n            divgroups.find('.wrapperlistgroup').replaceWith(response.newelement);\n            divgroups.find('.block_groups_toggle').on('click', {courseid: event.data.courseid}, changevisibility);\n            checkMember(response);\n            // Outputvisibility 0->nogroups 1 -> hidden 2->visible 3-> all are hidden 4-> all are visible.\n            str.get_strings([\n                {key: 'groupschangedhidden', component: 'block_groups'},\n                {key: 'groupschangedvisible', component: 'block_groups'},\n                {key: 'allgroupsinstatehidden', component: 'block_groups'},\n                {key: 'allgroupsinstatevisible', component: 'block_groups'}\n            ]).done(function(s) {\n                switch (response.visibility) {\n                    case 1:\n                        addNotification('success', s[0]);\n                        break;\n                    case 2:\n                        addNotification('success', s[1]);\n                        break;\n                    case 3:\n                        addNotification('warning', s[2]);\n                        break;\n                    case 4:\n                        addNotification('warning', s[3]);\n                        break;\n                    default:\n                        break;\n                }\n            }).fail(notification.exception);\n            return false;\n        }).fail(function() {\n            addWarning('all');\n            return false;\n        });\n        removeSpinners();\n        return false;\n    };\n\n    /**\n     * Calls for the main method. Either single groups are changed with block_groups_toggle or all groups with\n     * block_groups_all_toggle.\n     * @param {Number} courseid\n     */\n    return {\n        initialise: function(courseid) {\n            $('.block_groups_toggle').on('click', {courseid: courseid}, changevisibility);\n            $('.block_groups_all_toggle').on('click', {courseid: courseid}, changeVisibilityAll);\n\n        }\n    };\n});\n"],"file":"blocks_groups_visibility.min.js"}
define ("block_groups/blocks_groups_visibility",["jquery","core/ajax","core/url","core/notification","core/str"],function(a,b,c,d,e){var f=function(b){a(".block_groups").find(".warning"+b).remove()},g=function(b){var c=a(".block_groups");c.find(".spinner"+b).remove();c.find(".imggroup-"+b).show()},h=function(){var b=a(".block_groups");b.find(".spinner-all").remove();b.find(".imggroup").show()},i=function(){location.reload(!0)},j=function(){e.get_strings([{key:"errortitle",component:"block_groups"},{key:"nochangeindatabasepossiblereload",component:"block_groups"},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],i)}).fail(d.exception)},k=function(b){var d=a(".block_groups");if(0<d.find(".warning"+b).length){f(b)}var e=c.imageUrl("i/loading_small","moodle"),g=document.createElement("img");g.className="spinner"+b+" spinner block-groups-spinner";g.src=e;g.hidden=!1;d.find(".imggroup-"+b).before(g);d.find(".imggroup-"+b).hide()},l=function(b){var d=a(".block_groups"),e=d.find(".warning"+b);if(e.length){g(b);return!1}else{if("all"===b){h()}else{g(b)}var f=c.imageUrl("i/warning","moodle"),i=document.createElement("img");i.className="warning"+b+" block-groups-warning";i.src=f;j();d.find(".imggroup-"+b).before(i);d.find(".imggroup-"+b).on("click",j);d.find(".warning"+b).on("click",j)}return!1},m=function(c){var d=a(".block_groups"),e=a(this).data("groupid");if(0<d.find(".spinner"+a(this).data("groupid")).length||0<d.find(".spinner-all").length){return!1}k(a(this).data("groupid"));var f=b.call([{methodname:"block_groups_create_output",args:{groups:{id:a(this).data("groupid"),courseid:c.data.courseid}}}]);a(document).ajaxError(function(){l(e);return!1});f[0].then(function(a){if(null===a||!0===a.error){l(e);return!1}d.find(".group-"+a.id).replaceWith(a.newelement);if(0===a.visibility){d.find(".membergroup-"+a.id).removeClass("hiddengroups")}if(1===a.visibility){d.find(".membergroup-"+a.id).addClass("hiddengroups")}d.find(".group-"+a.id+" .block_groups_toggle").on("click",{courseid:c.data.courseid},m);g(a.id);return!1}).fail(function(){l(e);return!1});return!1},n=function(b){var c=a(".block-groups-membergroup"),d=b.visibility;if(2===d){c.removeClass("hiddengroups")}if(1===d){c.addClass("hiddengroups")}},o=function(){var b=a(".block_groups");if(0<b.find(".warningall").length){f("all")}var d=c.imageUrl("i/loading_small","moodle"),e=document.createElement("img");e.className="spinner-all spinner block-groups-spinner";e.src=d;e.hidden=!1;b.find(".imggroup").before(e);b.find(".imggroup").hide()},p=function(a,b){d.addNotification({message:b,type:a})},q=function(c){if(0<a(".block_groups").find(".spinner").length){return!1}var f=a(".block_groups").find(".block-groups-warning");if("undefined"!=typeof f&&0<f.length){l("all");return!1}o();var g=b.call([{methodname:"block_groups_create_allgroups_output",args:{groups:{action:a(this).data("action"),courseid:c.data.courseid}}}]);a(document).ajaxError(function(){l("all");return!1});g[0].then(function(b){var f=a(".block_groups");if(null===b||!0===b.error){l("all");return!1}if(0===b.visibility){f.find(".content").replaceWith(b.newelement);e.get_strings([{key:"nogroups",component:"block_groups"}]).done(function(a){p("error",a[0])}).fail(d.exception);return!1}f.find(".wrapperlistgroup").replaceWith(b.newelement);f.find(".block_groups_toggle").on("click",{courseid:c.data.courseid},m);n(b);e.get_strings([{key:"groupschangedhidden",component:"block_groups"},{key:"groupschangedvisible",component:"block_groups"},{key:"allgroupsinstatehidden",component:"block_groups"},{key:"allgroupsinstatevisible",component:"block_groups"}]).done(function(a){switch(b.visibility){case 1:p("success",a[0]);break;case 2:p("success",a[1]);break;case 3:p("warning",a[2]);break;case 4:p("warning",a[3]);break;default:break;}}).fail(d.exception);return!1}).fail(function(){l("all");return!1});h();return!1};return{initialise:function initialise(b){a(".block_groups_toggle").on("click",{courseid:b},m);a(".block_groups_all_toggle").on("click",{courseid:b},q)}}});
//# sourceMappingURL=blocks_groups_visibility.min.js.map
